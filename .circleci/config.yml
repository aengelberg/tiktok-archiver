version: 2.1
executors:
  docker-executor:
    docker:
      - image: circleci/golang:1.17

jobs:
  build-windows:
    executor: docker-executor
    steps:
      - checkout
      - setup_remote_docker:
          version: 20.10.7
          docker_layer_caching: true
      - run:
          name: Build Windows binary
          command: |
            docker run --rm -v $PWD:/app -w /app fyneio/fyne-cross:latest fyne-cross windows -arch=amd64

  build-macos-amd64:
    executor: docker-executor
    steps:
      - checkout
      - setup_remote_docker:
          version: 20.10.7
          docker_layer_caching: true
      - run:
          name: Build macOS (amd64) binary
          command: |
            docker run --rm -v $PWD:/app -w /app fyneio/fyne-cross:latest fyne-cross darwin -arch=amd64

  build-macos-arm64:
    executor: docker-executor
    steps:
      - checkout
      - setup_remote_docker:
          version: 20.10.7
          docker_layer_caching: true
      - run:
          name: Build macOS (arm64) binary
          command: |
            docker run --rm -v $PWD:/app -w /app fyneio/fyne-cross:latest fyne-cross darwin -arch=arm64

workflows:
  version: 2
  build-deploy:
    jobs:
      - build-windows
      - build-macos-amd64
      - build-macos-arm64
